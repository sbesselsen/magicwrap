!function(){"use strict";function e(n,t){if(t<=0)throw"n must be greater than 0";t>1&&(this.shorterNgramIndex=new e(n,t-1)),this.ngramIndices={},this.ngrams={},this.words=n.slice(),this.n=t;for(var r=s.generateNgrams(n,t),i=0;i<r.length;i++){var a=r[i],o=s.ngramKey(a);this.ngrams[o]=a,this.ngramIndices[o]||(this.ngramIndices[o]=[]),this.ngramIndices[o].push(i)}}function n(e){e||(e={}),this.nGramSize=e.nGramSize||3,this.maxChanges=e.maxChanges||10,this.isContentElement=e.isContentElement||function(){return!0}}function t(e){if(e.nodeName){if((""+e.nodeName).toLowerCase().match(/^(span|a|i|b|em|strong|h[123456]|abbr|font)$/))return!0}return!1}function r(e){return!0}var i={};i.walkElements=function(e,n,t){if(e.length>0&&e[0].tagName){var r=e[0].tagName.toUpperCase();if("SCRIPT"===r||"IFRAME"===r)return}n&&n(e);var i=this;e.contents().each(function(){i.walkElements(e.constructor.call(null,this),n,t)}),t&&t(e)},i._isLineBreakingTag=function(e){var n=e.toUpperCase();return"P"===n||"DIV"==n||"SECTION"===n||"ARTICLE"===n||"BR"===n||"HR"===n||"TABLE"===n||"TR"===n||"TD"===n||"TH"===n||"LI"===n},i.serializeElementText=function(e,n){var t=[],r=0;return i.walkElements(e,function(e){n(e[0])||r++,r>0||e[0].nodeType===Node.TEXT_NODE&&t.push(e[0].nodeValue)},function(e){n(e[0])||r--,r>0||e[0].tagName&&i._isLineBreakingTag(e[0].tagName)&&t.push(" ")}),t.join("")},i.serializeElementTextWithOffsets=function(e,n){var t=[],r=[],a=0,s=0;return i.walkElements(e,function(e){if(n(e[0])||s++,!(s>0)&&e[0].nodeType===Node.TEXT_NODE){var i=e[0].nodeValue;t.push({offset:a,length:i.length,node:e[0]}),r.push(i),a+=i.length}},function(e){n(e[0])||s--,s>0||e[0].tagName&&i._isLineBreakingTag(e[0].tagName)&&(r.push(" "),a++)}),{nodeInfo:t,text:r.join("")}};var a={};a.uniqueNumbers=function(e){var n=e.slice();n.sort();for(var t=[],r=null,i=0;i<n.length;i++)0!==i&&r===n[i]||t.push(n[i]),r=n[i];return t};var s={};s.generateNgrams=function(e,n){for(var t=[],r=0;r<=e.length-n;r++)t.push(e.slice(r,r+n));return t},s.ngramKey=function(e){return e.join("|")},e.prototype.indicesOf=function(e){if(0===e.length)return[];if(e.length<this.n)return this.shorterNgramIndex.indicesOf(e);if(e.length>this.n){for(var n=e.slice(0,this.n),t=this.indicesOf(n),r=[],i=0;i<t.length;i++)this.hasWordsAtIndex(e,t[i])&&r.push(t[i]);return r}var a=s.ngramKey(e);return this.ngramIndices[a]||[]},e.prototype.hasWordsAtIndex=function(e,n){for(var t=0;t<Math.min(e.length,this.words.length-n);t++)if(this.words[t+n]!==e[t])return!1;return!0},e.prototype.wordArray=function(){return this.words};var o={};o.tokenizeString=function(e){var n=(" "+e).split(/\b/);n[0]=n[0].substr(1);var t=[];t.push(["",n[0]]),n.length%2==0&&n.push("");for(var r=1;r<n.length-1;r+=2)t.push([n[r],n[r+1]]);return""===t[0][0]&&""===t[0][1]&&t.shift(),t},o.tokenWords=function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t][0]);return n},o.normalizeTokens=function(e){for(var n=[],t=0;t<e.length;t++)n.push([this.normalizeWord(e[t][0]),e[t][1]]);return n},o.normalizeWord=function(e){return e.toLowerCase()};var h={};h.bestMatchSequence=function(e,n,t,r){t||(t=3),n.length<t&&(t=n.length);for(var i=e.wordArray(),o=s.generateNgrams(n,t),u=[],l={},f=0;f<o.length;f++)for(var c=o[f],p=e.indicesOf(c),d=0;d<p.length;d++)for(var g=[p[d]-f-r,p[d]-f],m=0;m<g.length;m++){var v=g[m];l[v]?l[v]++:l[v]=1,l[v]>=2&&u.push(v)}u=a.uniqueNumbers(u);for(var x=null,f=0;f<u.length;f++){var v=u[f],T=i.slice(v,v+2*r+2*n.length),w=h.prefixDistance(T,n,1,1,0,r);(!x||w.distance<x.distance||w.distance===x.distance&&v<x.startIndex)&&(x=w,x.startIndex=v)}if(!x)return null;for(var N=0,E=x.startIndex,k=x.distance,f=0;f<x.operations.length;f++)if(-1===x.operations[f])E++,k-=1;else{if(1!==x.operations[f])break;k-=1}for(;f<x.operations.length;f++)1!==x.operations[f]&&N++;return{index:E,length:N,distance:k}},h.distance=function(e,n,t,r,i,a){for(var s={},o=(function o(h,u){var l=h+"|"+u;if(l in s)return s[l];if(0===h&&0===u)return{distance:0,operation:null,prev:null};if(a>0&&Math.abs(h-u)>a)if(e.length>n.length){if(u<n.length||h<u)return null}else if(h<e.length||u<h)return null;var f;if(h>0){var c=o(h-1,u);if(c){var p={distance:c.distance+t,operation:-1,prev:c};(!f||p.distance<f.distance)&&(f=p)}}if(u>0){var c=o(h,u-1);if(c){var d={distance:c.distance+r,operation:1,prev:c};(!f||d.distance<f.distance)&&(f=d)}}if(h>0&&u>0&&e[h-1]===n[u-1]){var c=o(h-1,u-1);if(c){var g={distance:c.distance+i,operation:0,prev:c};(!f||g.distance<f.distance)&&(f=g)}}return s[l]=f,f}(e.length,n.length)),h={distance:o.distance,operations:[]};null!==o.operation;)h.operations.unshift(o.operation),o=o.prev;return h},h.prefixDistance=function(e,n,t,r,i,a){for(var s=this.distance(e,n,t,r,i,a),o=s.operations.length-1;o>=0;o--){var h=s.operations[o];if(0===h)break;-1===h?s.distance-=t:1===h&&(s.distance-=r)}return s.operations=s.operations.slice(0,o+1),s},n.prototype.populateIndexWithTokens=function(n){this.tokens=n;var t=o.normalizeTokens(n),r=o.tokenWords(t);this.index=new e(r,this.nGramSize)},n.prototype.populateIndexWithString=function(e){var n=o.tokenizeString(e);return this.populateIndexWithTokens(n)},n.prototype.populateIndexWithElement=function(e){return this.populateIndexWithString(i.serializeElementText(e,this.isContentElement))},n.prototype.matchString=function(e){var n=o.tokenizeString(e);return this.matchTokens(n)},n.prototype.matchTokens=function(e){if(!this.index)return null;var n=o.normalizeTokens(e),t=o.tokenWords(n),r=h.bestMatchSequence(this.index,t,this.nGramSize,this.maxChanges);if(!r)return null;for(var i={offset:0,length:0,distance:r.distance,str:null},a=0;a<r.index;a++){var s=this.tokens[a];i.offset+=s[0].length+s[1].length}for(var u=[],a=0;a<r.length;a++){var s=this.tokens[r.index+a];u.push(s[0]),a<r.length-1&&u.push(s[1])}return i.str=u.join(""),i.length=i.str.length,i},$.fn.magicwrap=function(e){function a(n,t,r,a,s){for(var o=[],h=i.serializeElementTextWithOffsets(n,s),u=h.text.indexOf(t),l=0;l<h.nodeInfo.length;l++){var f=h.nodeInfo[l];if(f.offset>=u+t.length)break;if(!(f.offset+f.length<u)){var c=Math.max(0,u-f.offset),p=Math.min(f.length,u+t.length-f.offset),d=f.node;c>0&&(d=f.node.splitText(c)),p<f.length&&d.splitText(p-c),o.push(d)}}var g=[],m=o.slice();return i.walkElements(n,function(e){var n=e[0];if(n.nodeType===Node.TEXT_NODE){if(""===n.nodeValue)return;for(var t=-1!==o.indexOf(n),r=0;r<g.length;r++)g[r].hasTextNodes=!0,g[r].fullyContained=g[r].fullyContained&&t,t&&g[r].wrappedMatchNodes.push(n)}else g.push({node:n,fullyContained:!0,hasTextNodes:!1,wrappedMatchNodes:[]})},function(e){if(e[0].nodeType!==Node.TEXT_NODE){var n=g.pop();if(n.fullyContained&&n.hasTextNodes&&a(e[0])){m.push(n.node);for(var t=0;t<n.wrappedMatchNodes.length;t++){var r=m.indexOf(n.wrappedMatchNodes[t]);-1!==r&&m.splice(r,1)}}}}),e(m).wrap(r)}function s(e,t){var r=new n({isContentElement:t});r.populateIndexWithElement(e);var i=e.data("magicwrap")||{};i.matcher=r,e.data("magicwrap",i)}function o(e){e.removeData("magicwrap"),h(e)}function h(e){e.find(".magicwrap").contents().unwrap()}function u(n,t,r,i){var s=n.data("magicwrap");if(s&&s.matcher){for(var o=s.matcher,h=0;h<t.length;h++){var u=t[h],l=null;if(u.exactStr)l=u.exactStr;else{var f=o.matchString(u.str);f&&(l=f.str)}l&&a(n,l,'<span class="magicwrap"></span>',r,i).parent().data("magicwrap-wrap",u)}return e(".magicwrap")}}return function(e,n){n||(n={});var i=n.wraps||[],a=n.isContentElement||r,l=n.isWrappableElement||t;switch(e){case"apply":return o(this),s(this,a),u(this,i,l,a);case"update":return h(this),u(this,i,l,a);case"remove":h(this),o(this)}}}($)}();