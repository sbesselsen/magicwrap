!function(){function e(e){e||(e={}),this.nGramSize=e.nGramSize||3,this.maxChanges=e.maxChanges||10}function t(e,n){if(n<=0)throw"n must be greater than 0";n>1&&(this.shorterNgramIndex=new t(e,n-1)),this.ngramIndices={},this.ngrams={},this.words=e.slice(),this.n=n;for(var r=u.generateNgrams(e,n),i=0;i<r.length;i++){var a=r[i],s=u.ngramKey(a);this.ngrams[s]=a,this.ngramIndices[s]||(this.ngramIndices[s]=[]),this.ngramIndices[s].push(i)}}function n(e,t,n){for(var r=[],i=h.serializeElementTextWithOffsets(e),a=i.text.indexOf(t),s=0;s<i.nodeInfo.length;s++){var o=i.nodeInfo[s];if(o.offset>=a+t.length)break;if(!(o.offset+o.length<a)){var l=Math.max(0,a-o.offset),u=Math.min(o.length,a+t.length-o.offset),f=o.node;l>0&&(f=o.node.splitText(l)),u<o.length&&f.splitText(u-l),r.push(f)}}var c=[],d=r.slice();return h.walkElements(e,function(e){var t=e[0];if(t.nodeType===Node.TEXT_NODE){if(""===t.nodeValue)return;for(var n=-1!==r.indexOf(t),i=0;i<c.length;i++)c[i].hasTextNodes=!0,c[i].fullyContained=c[i].fullyContained&&n,n&&c[i].wrappedMatchNodes.push(t)}else c.push({node:t,fullyContained:!0,hasTextNodes:!1,wrappedMatchNodes:[]})},function(e){if(e[0].nodeType!==Node.TEXT_NODE){var t=c.pop();if(t.fullyContained&&t.hasTextNodes){d.push(t.node);for(var n=0;n<t.wrappedMatchNodes.length;n++){var r=d.indexOf(t.wrappedMatchNodes[n]);-1!==r&&d.splice(r,1)}}}}),$(d).wrap(n)}function r(t){var n=new e;n.populateIndexWithElement(t);var r=t.data("magicwrap")||{};r.matcher=n,t.data("magicwrap",r)}function i(e){e.removeData("magicwrap"),a(e)}function a(e){e.find(".magicwrap").contents().unwrap()}function s(e,t){var r=e.data("magicwrap");if(r&&r.matcher){for(var i=r.matcher,a=0;a<t.length;a++){var s=t[a],o=null;if(s.exactStr)o=s.exactStr;else{var h=i.matchString(s.str);h&&(o=h.str)}o&&n(e,o,'<span class="magicwrap"></span>').parent().data("magicwrap-wrap",s)}return $(".magicwrap")}}var o={};o.uniqueNumbers=function(e){var t=e.slice();t.sort();for(var n,r=[],i=0;i<t.length;i++)0!==i&&n===t[i]||r.push(t[i]),n=t[i];return r};var h={};h.walkElements=function(e,t,n){if(e.length>0&&e[0].tagName){var r=e[0].tagName.toUpperCase();if("SCRIPT"===r||"IFRAME"===r)return}t&&t(e);var i=this;e.contents().each(function(){i.walkElements($(this),t,n)}),n&&n(e)},h.serializeElementText=function(e){var t=[];return h.walkElements(e,function(e){e[0].nodeType===Node.TEXT_NODE&&t.push(e[0].nodeValue)}),t.join("")},h.serializeElementTextWithOffsets=function(e){var t=[],n=[],r=0;return h.walkElements(e,function(e){if(e[0].nodeType===Node.TEXT_NODE){var i=e[0].nodeValue;t.push({offset:r,length:i.length,node:e[0]}),n.push(i),r+=i.length}}),{nodeInfo:t,text:n.join("")}};var l={};l.bestMatchSequence=function(e,t,n,r){n||(n=3),t.length<n&&(n=t.length);for(var i=e.wordArray(),a=u.generateNgrams(t,n),s=[],h={},f=0;f<a.length;f++)for(var c=a[f],d=e.indicesOf(c),p=0;p<d.length;p++){var g=d[p]-f-r;h[g]?h[g]++:h[g]=1,h[g]>=2&&s.push(g)}s=o.uniqueNumbers(s);for(var v=null,f=0;f<s.length;f++){var g=s[f],m=i.slice(g,g+2*r+2*t.length),x=l.prefixDistance(m,t,1,1,0,r);(!v||x.distance<v.distance||x.distance===v.distance&&g<v.startIndex)&&(v=x,v.startIndex=g)}if(!v)return null;for(var w=0,T=v.startIndex,N=v.distance,f=0;f<v.operations.length&&-1===v.operations[f];f++)T++,N-=1;for(;f<v.operations.length;f++)1!==v.operations[f]&&w++;return{index:T,length:w,distance:N}},l.distance=function(e,t,n,r,i,a){for(var s={},o=(function(h,l){var u=h+"|"+l;if(u in s)return s[u];if(0===h&&0===l)return{distance:0,operation:null,prev:null};if(a>0&&Math.abs(h-l)>a)if(e.length>t.length){if(l<t.length||h<l)return null}else if(h<e.length||l<h)return null;var f;if(h>0){var c=o(h-1,l);if(c){var d={distance:c.distance+n,operation:-1,prev:c};(!f||d.distance<f.distance)&&(f=d)}}if(l>0){var c=o(h,l-1);if(c){var p={distance:c.distance+r,operation:1,prev:c};(!f||p.distance<f.distance)&&(f=p)}}if(h>0&&l>0&&e[h-1]===t[l-1]){var c=o(h-1,l-1);if(c){var g={distance:c.distance+i,operation:0,prev:c};(!f||g.distance<f.distance)&&(f=g)}}return s[u]=f,f}),h=o(e.length,t.length),l={distance:h.distance,operations:[]};null!==h.operation;)l.operations.unshift(h.operation),h=h.prev;return l},l.prefixDistance=function(e,t,n,r,i,a){for(var s=this.distance(e,t,n,r,i,a),o=s.operations.length-1;o>=0;o--){var h=s.operations[o];if(0===h)break;-1===h?s.distance-=n:1===h&&(s.distance-=r)}return s.operations=s.operations.slice(0,o+1),s},e.prototype.populateIndexWithTokens=function(e){this.tokens=e;var n=f.normalizeTokens(e),r=f.tokenWords(n);this.index=new t(r,this.nGramSize)},e.prototype.populateIndexWithString=function(e){var t=f.tokenizeString(e);return this.populateIndexWithTokens(t)},e.prototype.populateIndexWithElement=function(e){return this.populateIndexWithString(h.serializeElementText(e))},e.prototype.matchString=function(e){var t=f.tokenizeString(e);return this.matchTokens(t)},e.prototype.matchTokens=function(e){if(!this.index)return null;var t=f.normalizeTokens(e),n=f.tokenWords(t),r=l.bestMatchSequence(this.index,n,this.nGramSize,this.maxChanges);if(!r)return null;for(var i={offset:0,length:0,distance:r.distance,str:null},a=0;a<r.index;a++){var s=this.tokens[a];i.offset+=s[0].length+s[1].length}for(var o=[],a=0;a<r.length;a++){var s=this.tokens[r.index+a];o.push(s[0]),a<r.length-1&&o.push(s[1])}return i.str=o.join(""),i.length=i.str.length,i};var u={};u.generateNgrams=function(e,t){for(var n=[],r=0;r<=e.length-t;r++)n.push(e.slice(r,r+t));return n},u.ngramKey=function(e){return e.join("|")},t.prototype.indicesOf=function(e){if(0===e.length)return[];if(e.length<this.n)return this.shorterNgramIndex.indicesOf(e);if(e.length>this.n){for(var t=e.slice(0,this.n),n=this.indicesOf(t),r=[],i=0;i<n.length;i++)this.hasWordsAtIndex(e,n[i])&&r.push(n[i]);return r}var a=u.ngramKey(e);return this.ngramIndices[a]||[]},t.prototype.hasWordsAtIndex=function(e,t){for(var n=0;n<Math.min(e.length,this.words.length-t);n++)if(this.words[n+t]!==e[n])return!1;return!0},t.prototype.wordArray=function(){return this.words};var f={};f.tokenizeString=function(e){var t=(" "+e).split(/\b/);t[0]=t[0].substr(1);var n=[];n.push(["",t[0]]),t.length%2==0&&t.push("");for(var r=1;r<t.length-1;r+=2)n.push([t[r],t[r+1]]);return""===n[0][0]&&""===n[0][1]&&n.shift(),n},f.tokenWords=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][0]);return t},f.normalizeTokens=function(e){for(var t=[],n=0;n<e.length;n++)t.push([this.normalizeWord(e[n][0]),e[n][1]]);return t},f.normalizeWord=function(e){return e.toLowerCase()},$.fn.magicwrap=function(e,t){t||(t={});var n=t.wraps||[];switch(e){case"apply":return i(this),r(this),s(this,n);case"update":return a(this),s(this,n);case"remove":a(this),i(this)}}}();