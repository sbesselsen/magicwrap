!function(){function e(e){e||(e={}),this.nGramSize=e.nGramSize||3,this.maxChanges=e.maxChanges||10}function n(e,t){if(t<=0)throw"n must be greater than 0";t>1&&(this.shorterNgramIndex=new n(e,t-1)),this.ngramIndices={},this.ngrams={},this.words=e.slice(),this.n=t;for(var r=f.generateNgrams(e,t),a=0;a<r.length;a++){var i=r[a],s=f.ngramKey(i);this.ngrams[s]=i,this.ngramIndices[s]||(this.ngramIndices[s]=[]),this.ngramIndices[s].push(a)}}function t(e,n,t){for(var r=[],a=h.serializeElementTextWithOffsets(e),i=a.text.indexOf(n),s=0;s<a.nodeInfo.length;s++){var o=a.nodeInfo[s];if(o.offset>=i+n.length)break;if(!(o.offset+o.length<i)){var u=Math.max(0,i-o.offset),f=Math.min(o.length,i+n.length-o.offset),l=o.node;u>0&&(l=o.node.splitText(u)),f<o.length&&l.splitText(f-u),r.push(l)}}var c=[],p=r.slice();return h.walkElements(e,function(e){var n=e[0];if(n.nodeType===Node.TEXT_NODE){if(""===n.nodeValue)return;for(var t=-1!==r.indexOf(n),a=0;a<c.length;a++)c[a].hasTextNodes=!0,c[a].fullyContained=c[a].fullyContained&&t,t&&c[a].wrappedMatchNodes.push(n)}else c.push({node:n,fullyContained:!0,hasTextNodes:!1,wrappedMatchNodes:[]})},function(e){if(e[0].nodeType!==Node.TEXT_NODE){var n=c.pop();if(n.fullyContained&&n.hasTextNodes){p.push(n.node);for(var t=0;t<n.wrappedMatchNodes.length;t++){var r=p.indexOf(n.wrappedMatchNodes[t]);-1!==r&&p.splice(r,1)}}}}),$(p).wrap(t)}function r(n){var t=new e;t.populateIndexWithElement(n);var r=n.data("magicwrap")||{};r.matcher=t,n.data("magicwrap",r)}function a(e){e.removeData("magicwrap"),i(e)}function i(e){e.find(".magicwrap").contents().unwrap()}function s(e,n){var r=e.data("magicwrap");if(r&&r.matcher){for(var a=r.matcher,i=0;i<n.length;i++){var s=n[i],o=null;if(s.exactStr)o=s.exactStr;else{var h=a.matchString(s.str);h&&(o=h.str)}o&&t(e,o,'<span class="magicwrap"></span>').parent().data("magicwrap-wrap",s)}return $(".magicwrap")}}var o={};o.uniqueNumbers=function(e){var n=e.slice();n.sort();for(var t,r=[],a=0;a<n.length;a++)0!==a&&t===n[a]||r.push(n[a]),t=n[a];return r};var h={};h.walkElements=function(e,n,t){if(e.length>0&&e[0].tagName){var r=e[0].tagName.toUpperCase();if("SCRIPT"===r||"IFRAME"===r)return}n&&n(e);var a=this;e.contents().each(function(){a.walkElements($(this),n,t)}),t&&t(e)},h._isLineBreakingTag=function(e){var n=e.toUpperCase();return"P"===n||"DIV"==n||"SECTION"===n||"ARTICLE"===n},h.serializeElementText=function(e){var n=[];return h.walkElements(e,function(e){e[0].nodeType===Node.TEXT_NODE&&n.push(e[0].nodeValue)},function(e){e[0].tagName&&h._isLineBreakingTag(e[0].tagName)&&n.push(" ")}),n.join("")},h.serializeElementTextWithOffsets=function(e){var n=[],t=[],r=0;return h.walkElements(e,function(e){if(e[0].nodeType===Node.TEXT_NODE){var a=e[0].nodeValue;n.push({offset:r,length:a.length,node:e[0]}),t.push(a),r+=a.length}},function(e){e[0].tagName&&h._isLineBreakingTag(e[0].tagName)&&(t.push(" "),r++)}),{nodeInfo:n,text:t.join("")}};var u={};u.bestMatchSequence=function(e,n,t,r){t||(t=3),n.length<t&&(t=n.length);for(var a=e.wordArray(),i=f.generateNgrams(n,t),s=[],h={},l=0;l<i.length;l++)for(var c=i[l],p=e.indicesOf(c),d=0;d<p.length;d++){var g=p[d]-l-r;h[g]?h[g]++:h[g]=1,h[g]>=2&&s.push(g)}s=o.uniqueNumbers(s);for(var v=null,l=0;l<s.length;l++){var g=s[l],m=a.slice(g,g+2*r+2*n.length),x=u.prefixDistance(m,n,1,1,0,r);(!v||x.distance<v.distance||x.distance===v.distance&&g<v.startIndex)&&(v=x,v.startIndex=g)}if(!v)return null;for(var w=0,T=v.startIndex,N=v.distance,l=0;l<v.operations.length;l++)if(-1===v.operations[l])T++,N-=1;else{if(1!==v.operations[l])break;N-=1}for(;l<v.operations.length;l++)1!==v.operations[l]&&w++;return{index:T,length:w,distance:N}},u.distance=function(e,n,t,r,a,i){for(var s={},o=(function(h,u){var f=h+"|"+u;if(f in s)return s[f];if(0===h&&0===u)return{distance:0,operation:null,prev:null};if(i>0&&Math.abs(h-u)>i)if(e.length>n.length){if(u<n.length||h<u)return null}else if(h<e.length||u<h)return null;var l;if(h>0){var c=o(h-1,u);if(c){var p={distance:c.distance+t,operation:-1,prev:c};(!l||p.distance<l.distance)&&(l=p)}}if(u>0){var c=o(h,u-1);if(c){var d={distance:c.distance+r,operation:1,prev:c};(!l||d.distance<l.distance)&&(l=d)}}if(h>0&&u>0&&e[h-1]===n[u-1]){var c=o(h-1,u-1);if(c){var g={distance:c.distance+a,operation:0,prev:c};(!l||g.distance<l.distance)&&(l=g)}}return s[f]=l,l}),h=o(e.length,n.length),u={distance:h.distance,operations:[]};null!==h.operation;)u.operations.unshift(h.operation),h=h.prev;return u},u.prefixDistance=function(e,n,t,r,a,i){for(var s=this.distance(e,n,t,r,a,i),o=s.operations.length-1;o>=0;o--){var h=s.operations[o];if(0===h)break;-1===h?s.distance-=t:1===h&&(s.distance-=r)}return s.operations=s.operations.slice(0,o+1),s},e.prototype.populateIndexWithTokens=function(e){this.tokens=e;var t=l.normalizeTokens(e),r=l.tokenWords(t);this.index=new n(r,this.nGramSize)},e.prototype.populateIndexWithString=function(e){var n=l.tokenizeString(e);return this.populateIndexWithTokens(n)},e.prototype.populateIndexWithElement=function(e){return this.populateIndexWithString(h.serializeElementText(e))},e.prototype.matchString=function(e){var n=l.tokenizeString(e);return this.matchTokens(n)},e.prototype.matchTokens=function(e){if(!this.index)return null;var n=l.normalizeTokens(e),t=l.tokenWords(n),r=u.bestMatchSequence(this.index,t,this.nGramSize,this.maxChanges);if(!r)return null;for(var a={offset:0,length:0,distance:r.distance,str:null},i=0;i<r.index;i++){var s=this.tokens[i];a.offset+=s[0].length+s[1].length}for(var o=[],i=0;i<r.length;i++){var s=this.tokens[r.index+i];o.push(s[0]),i<r.length-1&&o.push(s[1])}return a.str=o.join(""),a.length=a.str.length,a};var f={};f.generateNgrams=function(e,n){for(var t=[],r=0;r<=e.length-n;r++)t.push(e.slice(r,r+n));return t},f.ngramKey=function(e){return e.join("|")},n.prototype.indicesOf=function(e){if(0===e.length)return[];if(e.length<this.n)return this.shorterNgramIndex.indicesOf(e);if(e.length>this.n){for(var n=e.slice(0,this.n),t=this.indicesOf(n),r=[],a=0;a<t.length;a++)this.hasWordsAtIndex(e,t[a])&&r.push(t[a]);return r}var i=f.ngramKey(e);return this.ngramIndices[i]||[]},n.prototype.hasWordsAtIndex=function(e,n){for(var t=0;t<Math.min(e.length,this.words.length-n);t++)if(this.words[t+n]!==e[t])return!1;return!0},n.prototype.wordArray=function(){return this.words};var l={};l.tokenizeString=function(e){var n=(" "+e).split(/\b/);n[0]=n[0].substr(1);var t=[];t.push(["",n[0]]),n.length%2==0&&n.push("");for(var r=1;r<n.length-1;r+=2)t.push([n[r],n[r+1]]);return""===t[0][0]&&""===t[0][1]&&t.shift(),t},l.tokenWords=function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t][0]);return n},l.normalizeTokens=function(e){for(var n=[],t=0;t<e.length;t++)n.push([this.normalizeWord(e[t][0]),e[t][1]]);return n},l.normalizeWord=function(e){return e.toLowerCase()},$.fn.magicwrap=function(e,n){n||(n={});var t=n.wraps||[];switch(e){case"apply":return a(this),r(this),s(this,t);case"update":return i(this),s(this,t);case"remove":i(this),a(this)}}}();